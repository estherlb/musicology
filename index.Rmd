---
title: "  Music and Movies | Computational Musicology 2021"
author: "Esther L. Bakels <img src=\"logo.png\" style=\"float: left;\" width=\"35;\"/>"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    storyboard: true
    theme: flatly
---

```{r}
library(tidyverse)
library(spotifyr)
library(ggthemes)
library(ggrepel)
library(compmus)
library(flexdashboard)
library(shiny)
library(plotly)
library(knitr)
```

Homework {.storyboard}
============================

### Alice in Wonderland cepstrogram

```{r}
bzt <-
  get_tidy_audio_analysis("11liAe3FvMGspJ9x3a1xw4") %>% # Change URI.
  compmus_align(bars, segments) %>%                     # Change `bars`
  select(bars) %>%                                      #   in all three
  unnest(bars) %>%                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )
```
```{r}
bzt %>%
  compmus_gather_timbre() %>%
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude", title="Alice's Theme" ) +
  scale_fill_viridis_c() +                              
  theme_classic()
```

--- 

As shown in the conclusion, Alice's Theme is a song that is similar to my favorite songs when you look at tempo.\ bars - rms - euclidian

### Alice in Wonderland chromagram 
```{r}
alice_theme <-
  get_tidy_audio_analysis("5yJ4g5wiv77VzuhidvAnJ6") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

alice_theme %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_classic() +
  scale_fill_viridis_c()
```

---

Euclidian

### Alice in Wonderland self similarity matrix

```{r}
bzt %>%
  compmus_self_similarity(timbre, "cosine") %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "", title="Alice's Theme")
```

---
 
Chessboard pattern

### Titanic cepstrogram
```{r}
bzt2 <-
  get_tidy_audio_analysis("0yIM3MDx8UTwueyoZJobsb") %>% # Change URI.
  compmus_align(sections, segments) %>%                     # Change `bars`
  select(sections) %>%                                      #   in all three
  unnest(sections) %>%                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )
```
```{r}
bzt2 %>%
  compmus_gather_timbre() %>%
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude", title="The portrait" ) +
  scale_fill_viridis_c() +                              
  theme_classic()

```

---

As shown in the visualisation boxplots, the portrait is an outlier in my corpus when you look at tempo in the Theme Song playlist. section - rms - euclidian

### Titanic chromagram 
```{r}
portrait <-
  get_tidy_audio_analysis("0yIM3MDx8UTwueyoZJobsb") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

portrait %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_classic() +
  scale_fill_viridis_c()
```

---

Euclidean


### Titanic self similarity matrix

```{r}
bzt2 %>%
  compmus_self_similarity(timbre, "cosine") %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "", title="Portrait")
```

---

You can clearly see the fade-out in this self similarity matrix.


Introduction
==============================



#### Music and Movies

<img align="right" src="musicmovie.jpg">

Almost every movie has music in it. These soundtracks often play in the background of a movie, so you would expect the music is calmer than music you'd listen to. On the other hand, maybe there are some features in the music that are not so different from your own music. I made three playlists:

* A playlist with different theme songs, you could say these songs are the most important to a movie.
* A playlist with more soundtracks, other than a themesong, movies have a lot of other music in it. 
* An old playlist of mine where I stored my favorite songs over the last couple of years. 

My goal is to examine different features, compare them to one another and search for a feature that isn't that different from my music. When I find that feature, I hope to find the themesong that corresponds the most to my favorite songs.




Visualisation {.storyboard}
=============================================


### Tempo boxplot

```{r}
CM_themes <- get_playlist_audio_features("","6ubQSyY5AOAZOTLaBUFHWD")
CM_soundtrack <- get_playlist_audio_features("","5Lo1O7pS5PWc9z6UuplHyX")
CM_faves <- get_playlist_audio_features("","0QzlUG13KFnSFOqgxeEli2")
```
```{r}
songs <-
  bind_rows(
    CM_themes %>% mutate(category = "A. Theme songs"),
    CM_faves %>% mutate(category = "C. My songs"),
    CM_soundtrack %>% mutate(category = "B. more soundtracks")
  )
```
```{r}
movie_songs <-
  bind_rows(
    CM_themes %>% mutate(category = "A. Theme songs"),
    CM_soundtrack %>% mutate(category = "B. more soundtracks")
  )
```
```{r}
songs %>%
  ggplot(aes(x = category, y = tempo)) +
  geom_boxplot(aes(fill = category), show.legend = FALSE)+
  theme_wsj()+
  labs(title = "Tempo")+
  geom_text_repel(data = subset(movie_songs,tempo > 200), aes(label = track.name), size=3)

```

---

###### Boxplot 1: 
The median of the different categories is somewhat the same. The 50% around the median is differs more in category C, my songs. Category B has the lowest median, but an outlier with the highest tempo of all categories (The Portrait - James Horner).


### Energy boxplot

```{r}
songs %>%
  ggplot(aes(x = category, y = energy)) +
  geom_boxplot(aes(fill = category), show.legend = FALSE)+
  theme_wsj()+
  labs(title = "Energy")+
  geom_text_repel(data = subset(movie_songs, tempo > 200), aes(label = track.name), size=3)

```

---

###### Boxplot 2: 
The median of the different catogories is somewhat the same for theme songs and more soundtracks, but way higher for my songs. The median of category A is higher than B, this is maybe because theme songs are the main song of the movie. Category B also includes songs that are used as more background music in movies. The outlier "The Portrait" from boxplot 1 is this time one of the lowest few. 



### How did tempo change over the years?



```{r, results='hide'}
# Dataframe
df <- CM_themes %>%
 select(track.album.release_date, energy, tempo) %>%
 mutate(
  year = as.Date(track.album.release_date, format="%Y"),
)

# summarize
by_year <- df %>%
    group_by(year) %>%
    summarize(energy=median(energy), tempo=median(tempo))
by_year
```



```{r}
ggplot(by_year, aes(x=year, y=tempo))+
  geom_smooth(color= "#FC5959")+
  labs(title="Tempo over the years", subtitle = "Theme songs")+
  ylim(c(50,200))+
  theme_wsj()
```

---

###### Graph 1:
The median of tempo is plotted over the years. In boxplot 1, category A, we saw that the 50% around the median was small. In this graph, we can see that the 50% is so small because the tempo did not really change over the years. 



### How did energy change over the years?


```{r }
# plot

ggplot(by_year, aes(x=year, y=energy))+
  geom_smooth(color= "#FC5959")+
  labs(title="Energy over the years", subtitle = "Theme songs")+
  theme_wsj()

```

---

###### Graph 2:
The median is plotted over the years. In boxplot 2, category A, we saw that the 50% around the median was a lot bigger than boxplot 1. In this graph, we can see that the 50% is so big because the tempo did really change over the years. In the early stages, energy was at its highest point, but decreased rapidly. but around the 2000, energy has a turning point, and started to increase again.



### How popular were these songs? Tempo and Energy together.

```{r}
vs <- ggplot(songs, aes(energy, tempo, colour = category, size = track.popularity)) + 
  geom_point()+
  theme_solarized()+
  labs(title = "Tempo vs. Energy")

ggplotly(vs)


```

---

###### Graph 3:
If you click on A and B, only C will show. You'll see that a red cluster is formed in the right side of the plot. A and B together are more active on the left side.You don't see clusters forming in the up or down side. Tempo seems equally distributed for all the three playlists, unlike the other feature energy. We also saw this in the visualisation per feature. 



Conclusion
==========================


Column 1
----------------------------------------------

### Chromagran Alice in Wonderland theme song
```{r}
alice_theme <-
  get_tidy_audio_analysis("5yJ4g5wiv77VzuhidvAnJ6") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

alice_theme %>%
  mutate(pitches = map(pitches, compmus_normalise, "manhattan")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_solarized() +
  scale_fill_viridis_c()
```

COlumn 2 {data-width=300}
-----------------------------

### Further investigation tempo
#### What movie should I watch?


```{r}
my_songs_mean <- CM_faves %>%
  summarise(
    mean_tempo_my_songs = mean(tempo)
  )

```

The boxplots of tempo showed that "The Portrait" was an outlier in the Theme Songs playlist. I would also like to investigate the similarity between playlists. As was shown in the visualisations, the (median) tempo of the different playlists didn't really differ from each other. To know what soundtrack would fit the best in my favorite songs playlist, the average tempo of my favorite songs were calculated. \
The mean tempo of my favorite songs is: `r my_songs_mean`. \
One of the songs in the theme song playlist should correspond the most with this mean tempo. \
The corresponding track by this song is:

```{r}
# Print which theme song is closest to mean tempo of my songs
Themes_tempo <- CM_themes[,"tempo"]
Values <- abs(Themes_tempo-c(my_songs_mean))
Min_value = min(Values)
Index <- which(Values==Min_value)
endsong <- CM_themes[Index, "track.name"]

kable(endsong)

```


<img src="Cheshire_head.png">

