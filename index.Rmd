---
title: "Music and movies"
author: "Esther"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    storyboard: true
    theme: default
    vertical_layout: fill
---

```{r}
library(tidyverse)
library(spotifyr)
library(ggthemes)
library(ggrepel)
library(compmus)
library(flexdashboard)
library(shiny)
library(plotly)
```

### Introduction


### Visualisation energy

```{r}
CM_themes <- get_playlist_audio_features("","6ubQSyY5AOAZOTLaBUFHWD")
CM_soundtrack <- get_playlist_audio_features("","5Lo1O7pS5PWc9z6UuplHyX")
CM_faves <- get_playlist_audio_features("","0QzlUG13KFnSFOqgxeEli2")
```
```{r}
songs <-
  bind_rows(
    CM_themes %>% mutate(category = "B. Theme songs"),
    CM_faves %>% mutate(category = "A. My songs"),
    CM_soundtrack %>% mutate(category = "C. more soundtracks")
  )
```
```{r}
movie_songs <-
  bind_rows(
    CM_themes %>% mutate(category = "B. Theme songs"),
    CM_soundtrack %>% mutate(category = "C. more soundtracks")
  )
```
```{r, results='hide'}
songs %>%
  ggplot(aes(x = category, y = tempo)) +
  geom_boxplot()+
  theme_wsj()+
  labs(title = "Tempo")+
  geom_text_repel(data = subset(movie_songs, tempo > 200), aes(label = track.name), size=3)
```
```{r}
songs %>%
  ggplot(aes(x = category, y = energy)) +
  geom_boxplot()+
  theme_wsj()+
  labs(title = "Energy")
```

--- 


Songs from movies have a lower energy than my songs. Soundtracks aree intended as background music, so a song full energy could distract the watcher from the movie, so these results make sense. 

### Visualisation tempo

```{r, results='hide'}
# Dataframe
df <- CM_themes %>%
 select(track.album.release_date, energy, tempo) %>%
 mutate(
  year = as.Date(track.album.release_date, format="%Y"),
)

# summarize
by_year <- df %>%
    group_by(year) %>%
    summarize(energy=mean(energy), tempo=median(tempo))
by_year
```
```{r , fig.show='hide'}
# plot

ggplot(by_year, aes(x=year, y=energy))+
  geom_smooth()+
  labs(title="Energy over the years", subtitle = "Theme songs")+
  theme_wsj()

```
```{r}
ggplot(by_year, aes(x=year, y=tempo))+
  geom_smooth()+
  labs(title="Tempo over the years", subtitle = "Theme songs")+
  theme_wsj()
```




### Visualisation tempo and energy

```{r}
vs <- ggplot(songs, aes(energy, tempo, colour = category, size = track.popularity)) + 
  geom_point()+
  theme_solarized()+
  labs(title = "Tempo vs Energy")

ggplotly(vs)
```

---

Tempo seems equally distributed for all the three playlists, unlike the other features.





### Conclusion


```{r}
alice_theme <-
  get_tidy_audio_analysis("5yJ4g5wiv77VzuhidvAnJ6") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

alice_theme %>%
  mutate(pitches = map(pitches, compmus_normalise, "manhattan")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```

---


```{r}
my_songs_mean <- CM_faves %>%
  summarise(
    mean_tempo_my_songs = mean(tempo)
  )

valueBox(my_songs_mean, color="primary", caption = "Mean")
```


```{r}
# Print which theme song is closest to mean tempo of my songs
Themes_tempo <- CM_themes[,"tempo"]
Values <- abs(Themes_tempo-c(my_songs_mean))
Min_value = min(Values)
Index <- which(Values==Min_value)
 CM_themes[Index, "track.name"]

```

Tempo doesn't seem to deviate a lot from my music. I want to know what theme song corresponds with the mean tempo of my favorite songs.
